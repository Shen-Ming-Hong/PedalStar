# 光光星 PedalStar 🚴‍♂️✨

一個互動式兒童遊樂設施，透過踩踏腳踏車來累積能量並點亮 LED 燈光效果。

## 專案簡介

光光星是一個創新的兒童遊樂設施，將兒童腳踏車架高懸空，讓小朋友透過踩踏腳踏板來產生「能量」。在固定時間內，輪子旋轉的圈數越多，累積的能量就越多，相應地會點亮更多的 LED 燈，形成類似進度條的視覺效果，為小朋友帶來即時的視覺回饋與成就感。

## 功能特色

-   **能量累積系統**：透過霍爾感測器偵測輪子旋轉圈數
-   **即時燈光回饋**：根據累積能量動態點亮單色 LED 燈，形成進度條效果
-   **彈性配置**：LED 數量可調整（1-32 顆），滿足不同場景需求
-   **模組化設計**：使用 PCA9685 PWM 驅動器，節省 Arduino 腳位
-   **互動性強**：小朋友可以直接看到自己踩踏的成果
-   **安全設計**：腳踏車架空設計，安全無虞

## 硬體需求

### 主要元件

-   **Arduino Uno** - 主控制板
-   **霍爾感測器（Hall Sensor）模組** - 偵測輪子旋轉（型號：A3144）
-   **磁鐵** - 配合霍爾感測器使用
-   **PCA9685 PWM 驅動模組 × 2** - 16 通道 PWM 控制器（I²C 通訊）
-   **單色 LED × 32**（可調整） - 能量進度條顯示
-   **外部 5V 電源**（建議 2A 以上） - 為 LED 提供充足電流
-   **兒童腳踏車** - 遊樂設施主體

### 連接方式

```
Arduino Uno（簡化 I²C 架構）
├─ 霍爾感測器 → D2（數位腳位，支援中斷）
├─ I²C 通訊：
│  ├─ SDA → A4（資料線）
│  └─ SCL → A5（時鐘線）
├─ PCA9685 #1（位址 0x40，預設）
│  ├─ VCC → 5V（或外部電源）
│  ├─ GND → GND
│  ├─ SDA → A4（與 Arduino 並聯）
│  ├─ SCL → A5（與 Arduino 並聯）
│  └─ 通道 0-15 → LED #1-16
├─ PCA9685 #2（位址 0x41，焊接 A0）
│  ├─ VCC → 5V（或外部電源）
│  ├─ GND → GND
│  ├─ SDA → A4（與 Arduino 並聯）
│  ├─ SCL → A5（與 Arduino 並聯）
│  └─ 通道 0-15 → LED #17-32
└─ 外部 5V 電源（建議 2A+）→ PCA9685 VCC

```

**接線優化特色**：

-   僅使用 3 個 Arduino 腳位（D2 + A4 + A5）
-   I²C 匯流排架構，兩個 PCA9685 並聯連接
-   每個 PCA9685 控制 16 顆 LED
-   LED 數量可彈性調整（1-32 顆）
-   外部電源確保充足電流供應
-   PCA9685 #2 需焊接 A0 跳線以改變位址

## 專案結構

```

PedalStar/
├── platformio.ini # PlatformIO 專案配置檔
├── README.md # 專案說明文件（本檔案）
├── src/
│ └── main.cpp # 主程式碼
├── include/ # 標頭檔目錄
├── lib/ # 自訂函式庫目錄
└── test/ # 測試程式目錄

```

## 工作原理

1. **感測階段**：磁鐵固定在腳踏車輪子上，每旋轉一圈會經過霍爾感測器一次
2. **計數階段**：Arduino 透過中斷機制即時計算旋轉圈數
3. **能量累積**：根據旋轉圈數累積能量值（0-100%）
4. **燈光回饋**：能量越多，點亮的 LED 燈數量就越多，形成進度條效果
5. **PWM 驅動**：透過 I²C 協定控制 PCA9685，高效驅動多顆 LED
6. **能量衰減**：停止踩踏 3 秒後，能量會逐漸衰減（衰減速度可調整）

## 開發環境

本專案使用 **PlatformIO** 開發，支援：

-   平台：Atmel AVR
-   開發板：Arduino Uno
-   框架：Arduino
-   外部函式庫：Adafruit PWM Servo Driver Library v3.0.2+

## 參數調整

遊戲難度和顯示效果可透過修改 `src/main.cpp` 中的參數來調整：

### 關鍵參數說明

| 參數            | 說明                             | 調整建議                              |
| --------------- | -------------------------------- | ------------------------------------- |
| `NUM_LEDS`      | LED 總數量                       | 1-16 顆（單模組）或 1-32 顆（雙模組） |
| `MAX_ROTATIONS` | 達到 100% 能量所需的每秒旋轉圈數 | 增加=更難，減少=更容易                |
| `DECAY_RATE`    | 能量衰減速度（%/秒）             | 增加=能量消失更快                     |
| `IDLE_TIMEOUT`  | 開始衰減前的等待時間（毫秒）     | 增加=能量保持更久                     |
| `TIME_WINDOW`   | 能量計算週期（毫秒）             | 建議維持 1000                         |

### 難度建議值

根據使用者年齡和體力，可以調整以下參數組合：

**簡單模式**（適合年幼兒童，4-6 歲）：

```cpp
#define MAX_ROTATIONS 15    // 更容易達成
#define DECAY_RATE 5        // 能量保持較久
```

**適中模式**（適合一般兒童，7-9 歲）：

```cpp
#define MAX_ROTATIONS 20-25 // 需要一定努力
#define DECAY_RATE 6-8      // 適度衰減
```

**困難模式**（適合年長兒童，10 歲以上）：

```cpp
#define MAX_ROTATIONS 35-50 // 需要非常努力
#define DECAY_RATE 10-12    // 能量快速消失
```

💡 **調整建議**：先從較低的 `MAX_ROTATIONS` 值開始測試，觀察兒童實際踩踏速度後再逐步調整。

### LED 數量配置

在 `src/main.cpp` 中調整 LED 數量：

```cpp
#define NUM_LEDS 32  // ⚙️ LED 總數（可調整：1-32）
```

**配置建議**：

-   **小型裝置**：8-16 顆（使用 1 個 PCA9685）
-   **中型裝置**：16-24 顆（使用 2 個 PCA9685）
-   **大型裝置**：24-32 顆（使用 2 個 PCA9685）

💡 **注意**：當 `NUM_LEDS > 16` 時，需要使用第二個 PCA9685 模組（位址 0x41）

### 能量與燈光對應關係

能量百分比決定點亮的 LED 數量（進度條效果）：

```
能量階差 = 100% ÷ NUM_LEDS

範例（NUM_LEDS = 32）：
  能量   0% → 0 顆亮   ⚫⚫⚫⚫⚫⚫⚫⚫
  能量  25% → 8 顆亮   🟢🟢🟢🟢🟢🟢🟢🟢⚫⚫⚫⚫
  能量  50% → 16顆亮   🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢⚫⚫⚫⚫
  能量  75% → 24顆亮   🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢�⚫⚫
  能量 100% → 32顆亮   🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢
```

**範例計算**（假設 `MAX_ROTATIONS = 20`, `NUM_LEDS = 32`）：

-   點亮 1 顆燈：1 秒內轉 0.625 圈（3.125% × 20）
-   點亮 16 顆燈：1 秒內轉 10 圈（50% × 20）
-   點亮 32 顆燈：1 秒內轉 20 圈（100% × 20）

## 硬體設定

### PCA9685 I²C 位址配置

使用 2 個 PCA9685 時，需要設定不同的 I²C 位址：

1. **PCA9685 #1**：保持預設（所有跳線不焊接）→ 位址 `0x40`
2. **PCA9685 #2**：焊接 **A0** 跳線 → 位址 `0x41`

**焊接位置**：模組背面有 6 個焊接跳線（A0-A5），焊接 A0 即可。

### 供電建議

-   **LED < 20 顆**：可使用 Arduino 5V 輸出
-   **LED ≥ 20 顆**：建議使用外部 5V 2A 電源供應器
-   **電流計算**：每顆 LED 約 20mA，32 顆需 640mA

## 使用方式

### 1. 安裝開發環境

確保已安裝 [PlatformIO](https://platformio.org/) 或 [VS Code](https://code.visualstudio.com/) + PlatformIO 擴充套件。

### 2. 編譯專案

```bash
pio run
```

### 3. 上傳到 Arduino

```bash
pio run --target upload
```

### 4. 監控序列埠（除錯用）

```bash
pio device monitor
```

## 未來擴充

-   [ ] 新增音效回饋
-   [ ] 記錄最高分數
-   [ ] 多人競賽模式
-   [ ] 更多燈光效果模式

## 授權

本專案為教育與創作用途。

## 貢獻

歡迎提出建議與改進！

---

**打造屬於孩子們的能量世界！** 🌟
